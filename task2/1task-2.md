##什么是CSS
Cascading Style Sheet(css)是一门指定文档该如何呈现的语言。用户代理（UA）将文档以可视的形式进行呈现。所以css并非仅仅用于浏览器，浏览器只是用户代理其中之一。

##为何使用CSS
css帮助你将文档信息的内容和如何展现它的细节（样式）相分离。这样可以
* 避免重复
* 更容易维护
* 为不同的目的使用不同的样式而内容相同

##css如何工作
浏览器在展现一个文档的时候，必须要把文档内容和相应的样式信息结合起来展示。这个处理过程一般分为两个阶段：
* 浏览器先将标记语言和css转换成DOM结构，这时DOM就代表了电脑内存中的相应文档，因为它已经融合了文档内容和相应的样式表。
* 浏览器把DOM的内容展示出来。

DOM是一种树形结构，每个元素和非空文本都可以看作是树形结构上的一个节点。DOM节点不再是容器，但是它可以作为子节点的父节点而存在。理解DOM结构可以帮助你更好的设计，调试，维护css，因为DOM结构就是你的css和文档内容融合而成的。

##层叠和继承
* 样式表中元素如何父级继承样式
* 不同层级的样式如何相互作用决定最终显示效果
* 通过在样式表中添加级联样式语句，进一步控制页面元素的展现

对于层叠来说，主有三种主要样式来源：

> * 浏览器对HTML定义的默认样式
> * 用户定义的样式
> * 开发者定义的样式，可以有三种形式：
    * 定义在外部文件（外链样式）
    * 在页面头部定义（内联样式）：通过这种形式定义的样式只在本页面内生效
    * 定义在特定的元素身上（行内样式）：这种形式多用于测试，可维护性较差

开发者定义的样式（子元素自身的样式优先级高于从父元素继承来的样式）>用户定义的样式表>浏览器定义的默认样式。

> 网页上随便一个网页，有一部分样式是来自浏览器定义的默认的HTML样式。
> 
> 有一部分样式可能来自用户通过浏览器自定义的样式，或为浏览器引入自定义的样式表。在一些浏览器中用户可以自行设定网页字体和颜色，也可以建立一个单独的userContent.css样式文件并放到“用户配置”的文件夹中。（css提供了```!important```关键字，用户可以通过使用这个关键字使自己定义的样式覆盖掉开发者定义的样式）。
> 
> 还有一部分样式来自外链的服务器上的样式表。

####指定值，计算值，使用值，实际值
用户代理在解析文档并构建文档树后，必须为树中每一个元素的每一个属性分派一个适用于目标媒体类型的属性值。

属性值的最终取值是经过四步计算得出的结果：
> * 由文档指定的取值（指定值）考虑层叠和继承
> * 经过处理得到可被直接继承的取值（计算值） 计算
> * 再在必要时候转化成绝对值（使用值）有依赖的关系的计算
> * 最后根据本地环境的限制转换成最终值（实际值）UA对使用值近似处理后的结果

下面来详细解说属性值每一步的实现

* （1）指定值：用户代理必须先根据以下机制（按优先次序）为每一个属性分派指定值：
    * 1.若通过层叠得到一个值，且该值不是```inherit```，则使用这个取值
    * 2.否则，若得到的值是```inherit```，且该元素不是文档树的根，则使用父元素的计算值
    * 3.否则使用属性的初始值。每个属性的初始值都被记载在该属性的定义表格中。

有点难理解，举例来说
```html
<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta charset="utf-8">
    <style type="text/css">
        body{
            color: red ;
        }
        body{
            color: green ;
        }
  </style>
</head>
<body>
    文本
</body>
</html>
```

1.```body```元素的```color```属性层叠了，属性值不是```inherit```，则使用这个```green```值，所以最后效果就是```文本```呈现绿色。

2.将层叠属性的代码改为```inherit```
```html
<style type="text/css">
    body{
        color: red ;
    }
    body{
        color: inherit ;
    }
</style>
```
而且```body```又不是文档树的根，则使用父元素的计算值，因为父元素```html```默认的```color```属性值是```black```，所以```文本```最终会显示黑色。
```javascript
window.getComputedStyle($('body')).color;// "rgb(0, 0, 0)"
```

3.在以上两种情况都不符合情况下，比如层叠的```color```值是一个非法识别不了的值，这个时候就使用上一次定义的合法值。
```html
<style type="text/css">
    body{
        color: red ;
    }
    body{
        color: xx ;
    }
</style>
```
之后```文本```最终会显示红色。
```javascript
window.getComputedStyle($('body')).color;// "rgb(255, 0, 0)"
```
* （2）计算值（理想状态值）：指定值在层叠的时候经处理变成计算值（这种处理力求速度，所以不对文档进行排版）。举例来说，把URI都解析成绝对URI，把以```em```和```ex```为单位的值计算成像素值或是绝对长度值。在计算这些取值时不需要对文档进行渲染。
    * 若UA不能把某个URI解析成绝对URI则计算值仍为原指定值。
    * 属性的指定值由**属性定义表格**中计算值这一栏的方法决定。
    * 就算根据适用于这一栏的定义，一个属性为对某个元素不适用，但其计算值仍然存在（意思是计算后的值存在，但UA理解不了该值）。然而也有些属性会根据该属性是否适用于某个元素来决定元素属性的计算值。
* （3）使用值（理想状态值）：计算值是在不对文档进行排版的情况下，以最快速度处理得到的结果。但是有些值的计算只能在文档排版的时候才能决定，比如元素的宽度设为其包含块的某个百分比，那么决定其包含块的宽度之前，这个元素的宽度就不能决定。所以使用值是解决了剩下的依赖关系后，必要时计算出来的绝对值。
* （4）实际值（现实状态值）：原则上使用值就是在渲染时所采取的值，但在特定情况下UA可能无法理解这个值，比如UA可能只能渲染整数像素的边框，因此只能近似地计算宽度。实际值是UA对使用值经过近似处理后的结果。

####继承
一个文档树中一个元素的有些属性值会被其子元素继承，每个属性的**属性定义表格**分别描述了改属性会被继承与否。继承是透过文档树进行的。

当继承发生时，元素继承计算值。父元素的计算值同时成为子元素的指定值与计算值。
```css
    body{
        font-size:10pt;
    }
    h1{
        font-size:130%;
    }
```
```html
<body>
    <h1>文本</h1>
</body>
```
Chrome浏览器默认```html```的```font-size```值为```16px```，因为```16px=100%=1em=12pt```，```body```元素的```font-size```属性的指定值和计算值继承自```html```。最终的计算值是```16px*10pt/12pt=13.3333px```。```h1```元素同理继承```13.3333px```后，最终计算值为```13.33px*1.3=17.3333px```。
```javascript
window.getComputedStyle($('html')).fontSize;// "16px"
window.getComputedStyle($('body')).fontSize;// "13.3333px"
window.getComputedStyle($('h1')).fontSize;// "17.3333px"
```

####'inherit'值
每个属性都可以有```inherit```作为层叠值。```inherit```表示给定元素的指定值是该父元素的计算值。若根元素的某个属性设有```inherit```值，UA会把属性的初始值指派给该属性。

####@import规则
@import规则允许用户从其它样式表中导入样式。在css2.1中@import规则必须写在其它规则前面，这样UA才更快捷地知道何时忽略该规则。

@import关键字必须跟着要被导入的样式表URI或一个字符串（此字符串最终还是被当成url(...)包围着来解析）。
```html
    @import url("a.css");
    @import "a.css"
```
这样的效果是一样的。

作者可以指定限定媒体的@import规则，以避免UA为不支持的媒体去获取资源。只需在URI后指定以逗号分隔的媒体列表。
```html
    @import url("print.css") print;
    @import url("bluish.css") projection,tv;
    @import url("all.css")
```
第一句为打印设备指定样式表，第二句为投影和tv设备指定样式表。若没有指定媒体或指定```all```作为媒体（第三句），规则会被无条件导入。

注：如果同一个样式表被同一个文档导入或引用多次，UA必须像对待不同的样式表那样对每次引用都依次处理一遍。

####层叠
> * 层叠次序
> * !important规则
> * 计算选择器的特异度（特性值）







##参考
[css入门教程](https://developer.mozilla.org/zh-CN/docs/Web/Guide/CSS/Getting_started)

[w3c 分派属性值、层叠与继承](https://www.w3.org/html/ig/zh/wiki/CSS2/cascade)

[css继承性及其应用详解](http://developer.51cto.com/art/201009/224897_all.htm#585532-tsina-1-58356-7e393678b940a4d55500bf3feae3d2e9)
